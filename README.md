# 台股 Top 100 - 布林通道分析 

利用 TEJ 的資料來跑台股市值前 100 大的布林通道。

## 目標
計算**「布林帶寬 (Bandwidth)」**，讓大家可以有個動態的參考指標，用來輔助判斷停損或停利的位置。

## 布林通道簡介 (給沒用過的參考)
- **中軌**：20日均線 (股價的平均成本)。
- **上/下軌**：標準差 (股價正常的波動範圍)。

**主要看「帶寬 (Bandwidth)」：**
- 當通道**變窄 (壓縮)**：代表股價正在休息、累積能量，通常是**大行情(暴漲/暴跌)的前兆**。
- 當通道**變寬 (發散)**：代表波動很劇烈，可能過熱了。

**布林的缺點：**
- 滯後性 : 布林通道的中軌是 20日均線 (MA20)，可能要看變化率。
- 建議跟成交量一起看，避免headfake(股市假動作)。

##  資料處理
1. **資料清洗**：把那些股票上市前的一堆 `NaN` 空值都修好了，避免模型跑不動。
2. **算布林通道**：
   - 算出每支股票的 上/中/下 軌。
   - 算出 **「布林帶寬」** (看波動是壓縮還是發散)。
3. **產業比較**：
   - 多算了一個「同產業平均帶寬」。
   - 畫圖的時候可以把「個股」跟「產業平均」疊在一起看，比較好判斷它現在是不是過熱。
## 最後那張圖怎麼看？
程式會畫出一張 **"Dynamic Strategy Indicator"**，裡面有兩條線：

1. **藍線 (個股帶寬)**：這支股票自己的活躍度。
2. **橘虛線 (產業平均)**：這個產業大家的平均活躍度。

**觀察重點：**
- **當藍線跌到橘線下面 (極度壓縮)**：代表這支股票比同業都還平穩，可能有補漲或變盤的機會 (關注點)。
- **當藍線衝得比橘線高很多 (過熱)**：代表它波動率遠超同行，風險較高。

## 細節備註
- `alpha=0.3`：畫圖時設定的透明度。因為線疊在一起會看不清楚，設成 0.3 (半透明) 可以看清楚網格跟重疊的部分。
- `window=20`：使用標準的 20 日移動平均。

## 如何應用在模型中 (參考)
這些欄位可以直接替換原本的「固定 % 數」，讓模型變成動態調整：

| 應用場景 | 你的變數 (DataFrame Column) | 邏輯說明 |
| :--- | :--- | :--- |
| **Stop Loss** | `lower` (下軌) | 跌破下軌即停損 (比固定 5% 更抗震) |
| **Take Profit** | `upper` (上軌) | 碰到上軌或跌回上軌內再出 (比固定 10% 能吃到更多魚尾) |
| **Filter** | `bb_width` vs `sector_avg_width` | 當 `bb_width` < `sector_avg_width` 時進場，勝率較高 (買在盤整區) |

> **小提醒**：
> 如果模型 input 限定要Float，可以用這公式換算：
> `動態停損 % = (收盤價 - lower) / 收盤價`